@model POS.Models.PurchaseOrderVM
@using (Html.BeginForm("Update", "PurchaseOrder", FormMethod.Post, new { @id = "po-form-u" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    @Html.HiddenFor(c => c.Purchaseorder.PurchaseOrderID)
    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.PurchaseOrderDate
        </div>
        <div class="form-input">
            @*@Html.TextBoxFor(c => c.Purchaseorder.PurchaseOrderDate, new { @class = "form-control datepicker",@style="width:100%" })*@
            <input type="text" id="Purchaseorder.PurchaseOrderDate" class="form-control datepicker" />
        </div>
    </div>
    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.Location
        </div>
        <div class="form-input">
            @Html.DropDownListFor(c => c.Purchaseorder.FKLocationID, Model.getAllLocations(Model.User), new { @class = "form-control", @readonly = "readonly", @id = "Sale_FKLocationID" })

        </div>
    </div>
    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.Supplier
        </div>
        <div class="form-input">
            @Html.DropDownListFor(c => c.Purchaseorder.FKSupplierID, Model.getAllSupplier(), new { @class = "Purchaseorder_FKSupplierID form-control", @readonly = "readonly" })
        </div>
    </div>
    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.RequiredbyDate 
        </div>
        <div class="form-input">
           @* @Html.TextBoxFor(c => c.Purchaseorder.RequiredbyDate, new { @class = "form-control datepicker",@style="width:100%" })*@
            <input type="text" id="Purchaseorder.RequiredbyDate" class="form-control datepicker" />
        </div>
    </div>
    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.InvoiceNumber
        </div>
        <div class="form-input">
            @Html.TextBoxFor(c => c.Purchaseorder.ReferenceNumberPO, new { @class = "form-control", @readonly = "readonly" })
        </div>
    </div>
    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.SupplierInvoiceNumber
        </div>
        <div class="form-input">
            @Html.TextBoxFor(c => c.Purchaseorder.PaymentTerms, new { @class = "form-control" })
        </div>
    </div>
    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.ShipmentMethod
        </div>
        <div class="form-input">
            @Html.TextBoxFor(c => c.Purchaseorder.ShippinMethod, new { @class = "form-control" })
            @Html.HiddenFor(c=>c.Purchaseorder.Paid)
        </div>
    </div>
    <div class="quo-item-main">
        @*<input type="button" class="btn btn-warning  custombtn" onclick="addNewRowQoute()" value="Add New Row" />*@
        <div style="clear:both;"></div>
        <table class="table table-responsive" id="PO-items">
            <thead>
                <tr>
                    <th>@POS.Resources.Resource.SaleNo</th>
                    <th>@POS.Resources.Resource.Item</th>
                    <th>@POS.Resources.Resource.Product</th>
                    <th>@POS.Resources.Resource.Quantity</th>
                    <th>@POS.Resources.Resource.UnitPrice </th>
                    <th>@POS.Resources.Resource.SalePrice</th>
                    <th>@POS.Resources.Resource.Total</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @{var sn = 0;}
                @for (int i = 0; i < Model.Purchaseorder.Items.Count; i++)
                {
                    sn++;
                    if (Model.Purchaseorder.Items[i].Completed)
                    {
                        <tr>
                   
                            <td>
                                @sn
                            </td>
                            <td><input type="text" class="form-control item-search" value="@Model.Purchaseorder.Items[i].Item.ItemNoStr" readonly /></td>
                            <td>
                                <input id="Po-item-0"
                                       value="@Model.Purchaseorder.Items[i].Item.Name"
                                       class="sale-items form-control" readonly /> 
                                <input type='hidden' class="item-id-hdn" value="@Model.Purchaseorder.Items[i].FKItemID" name='PurchaseOrder.Items[@i].FKItemID' />
                                
                                <input type='hidden' class="item-id-hdnc" value="true" name='PurchaseOrder.Items[@i].Completed' />
                                <input type='hidden' class="item-id-hdnp" value="@Model.Purchaseorder.Items[i].PurchaseItemID" name='PurchaseOrder.Items[@i].PurchaseItemID' />
                            </td>
                            <td>
                                <input type="number" class="form-control sale-item-quantity" min="1" value="@Model.Purchaseorder.Items[i].Quantity" onblur="setItemTotalPO(this)" name="PurchaseOrder.Items[@i].Quantity" readonly />
                            </td>                           
                            <td>
                                <input type="number" class="form-control sale-item-price sale-item-cost" min="0" value="@Model.Purchaseorder.Items[i].UnitPrice" onchange="setItemTotalPO(this)" name="PurchaseOrder.Items[@i].UnitPrice" readonly />
                            </td>
                            <td>
                                <input type="number" class="form-control sale-item-price-po" min="0" value="@Model.Purchaseorder.Items[i].SalePrice" name="PurchaseOrder.Items[@i].SalePrice" readonly />
                            </td>
                            <td>
                                <input type="number" class="form-control sale-item-total" value="@Model.Purchaseorder.Items[i].Total" name="PurchaseOrder.Items[@i].Total" readonly />
                            </td>
                            <td class="image-col"><a href='#' onclick='openSaleImageModal(this)'>@POS.Resources.Resource.Image</a> <input type='hidden' class='img-src' value='@Model.Purchaseorder.Items[i].Item.Image' /></td>
                            <td></td>
                        </tr>
                    }
                    else
                    {
                        <tr>

                            <td>
                                @sn
                            </td>
                            <td><input type="text" class="form-control item-search" value="@Model.Purchaseorder.Items[i].Item.ItemNoStr" readonly /></td>
                            <td>
                                <input id="Po-item-0"
                                       value="@Model.Purchaseorder.Items[i].Item.Name"
                                       class="sale-items form-control" readonly /> 
                                <input type='hidden' class="item-id-hdn" value="@Model.Purchaseorder.Items[i].FKItemID" name='PurchaseOrder.Items[@i].FKItemID' />
                                
                                <input type='hidden' class="item-id-hdn" value="@Model.Purchaseorder.Items[i].PurchaseItemID" name='PurchaseOrder.Items[@i].PurchaseItemID' />
                            </td>
                            <td>
                                <input type="number" class="form-control sale-item-quantity" min="1" value="@Model.Purchaseorder.Items[i].Quantity" onchange="setItemTotalPO(this)" name="PurchaseOrder.Items[@i].Quantity" />
                            </td>                           
                            <td>
                                <input type="number" class="form-control sale-item-price sale-item-cost" min="0" value="@Model.Purchaseorder.Items[i].UnitPrice" onchange="setItemTotalPO(this)" name="PurchaseOrder.Items[@i].UnitPrice" />
                            </td> 
                            <td>
                                <input type="number" class="form-control sale-item-price-po" min="0" value="@Model.Purchaseorder.Items[i].SalePrice" name="PurchaseOrder.Items[@i].SalePrice" />
                            </td>
                            <td>
                                <input type="number" class="form-control sale-item-total" value="@Model.Purchaseorder.Items[i].Total" name="PurchaseOrder.Items[@i].Total" readonly />
                            </td>
                            <td class="image-col"><a href='#' onclick='openSaleImageModal(this)'>@POS.Resources.Resource.Image</a> <input type='hidden' class='img-src' value='@Model.Purchaseorder.Items[i].Item.Image' /></td>
                            <td><a onclick="removeRowPO(this)" href="#"><i class="fa fa-trash fa-fw"></i></a></td>
                        </tr>
                    }
                }

            </tbody>
        </table>
        <input type="button" class="btn btn-warning  custombtn" onclick="addNewRowPO()" value="@POS.Resources.Resource.AddNewRow " />
    </div>

    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.SubTotal 
        </div>
        <div class="form-input">
            @Html.TextBoxFor(c => c.Purchaseorder.SubTotal, new { @class = "form-control quo-sub", @readonly = "readonly" })

        </div>
    </div>
    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.Freight
        </div>
        <div class="form-input">
            @Html.TextBoxFor(c => c.Purchaseorder.Freight, new { @class = "form-control quo-dis", @onchange = "calculatePO()" })

        </div>
    </div>
    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.Discount
        </div>
        <div class="form-input">
            @Html.TextBoxFor(c => c.Purchaseorder.Discount, new { @class = "form-control quo-discount", @onchange = "calculatePO()" })

        </div>
    </div>
    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.Tax %
        </div>
        <div class="form-input">
            @Html.TextBoxFor(c => c.Purchaseorder.Tax, new { @class = "form-control quo-tax", @onchange = "calculatePO()" })

        </div>
    </div>
    <div class="form-row">
        <div class="form-lable">
            @POS.Resources.Resource.Total
        </div>
        <div class="form-input">
            @Html.TextBoxFor(c => c.Purchaseorder.Total, new { @class = "form-control quo-total", @readonly = "readonly" })

        </div>
    </div>

    <input type="submit" class="btn btn-primary custombtn" value="@POS.Resources.Resource.Save" />
    <input type="button" class="btn btn-primary custombtn" value="@POS.Resources.Resource.Back" onclick="getPurchaseOrder()" />

    <input type="button" class="btn btn-primary custombtn" value="@POS.Resources.Resource.Print" onclick="openModal()" />
}
<div class="modal fade prices-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">@POS.Resources.Resource.Prices</h4>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>
<div class="modal fade print-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">@POS.Resources.Resource.Print</h4>
            </div>
            <div class="modal-body">
                <div><button class="btn btn-default custombtn" onclick="printA()">@POS.Resources.Resource.Print</button><button class="btn btn-default custombtn" onclick="cancelPrint()">@POS.Resources.Resource.Cancel</button></div>
            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>
<script>
    function openModal() {
        $(".print-modal").modal("show");
    }
    function printA() {
        cancelPrint();
        var name = $("#Purchaseorder_FKSupplierID:selected").text();
        var sr = $("#Purchaseorder_ReferenceNumberPO").val();
        var date = $("#Purchaseorder_PurchaseOrderDate").val();
        var sn = 0;
        var docprint = window.open("about:blank", "_blank");
        docprint.document.open();
        docprint.document.write('<html><head><title></title>');
        docprint.document.write('<style>span { margin:3px; }</style>');
        docprint.document.write('</head><body style="width:100%;">');
        docprint.document.write('<div style="width:800px;padding:20px;float:left;">');
        docprint.document.write("<div style='text-align:center;'>");
        docprint.document.write("<div style='width:50%;margin-left:190px;margin-bottom:10px;border-radius:4px;border:solid 1px;'>");
        docprint.document.write('<div class="col-lg-12" style="text-align:right">TechCity</div><br/>');
        docprint.document.write("<div style='font-size:10px;'>Purchase Order</div>");
        docprint.document.write("<div style='font-size:8px;'>Invoice No : " + $("#Purchaseorder_ReferenceNumberPO").val() + " Location : " + $("#Sale_FKLocationID :selected").text() + "</div>");
        docprint.document.write("</div>");
        docprint.document.write("</div>");
        docprint.document.write("<div style='float:left;width:100%;text-align:left;font-size:10px;border:1px solid #000;'><span style='float:left;width:5%'>S.No</span><span style='float:left;width:15%'>CODE</span><span style='float:left;width:30%'>DESCRIPTION</span><span style='float:left;width:15%'>QTY</span><span style='float:left;width:15%'>UNIT PRICE</span><span style='float:left;width:15%'>AMOUNT</span></div>");
        $("#PO-items tbody tr").each(function () {
            var itemno = $(this).find(".item-search").val();
            var desc = $(this).find(".sale-items").val();
            var qty = $(this).find(".sale-item-quantity").val();
            var price = $(this).find(".sale-item-price").val();
            var total = $(this).find(".sale-item-total").val();
            sn++;
            docprint.document.write("<div style='float:left;width:100%;text-align:left;font-size:10px;border:1px solid #000;'><span style='float:left;width:5%'>" + sn + "</span><span style='float:left;width:15%'>" + itemno + "</span><span style='float:left;width:30%'>" + desc + "</span><span style='float:left;width:15%'>" + qty + "</span><span style='float:left;width:15%'>" + price + "</span><span style='float:left;width:15%'>" + total + "</span></div>");

        });
        var gTotal = $("#Purchaseorder_Total").val();
        docprint.document.write("<div style='float:left;width:100%;text-align:right;font-size:10px;border:1px solid #000;'>Total: " + gTotal + "</div>");
        docprint.document.write('</body></html>');
        docprint.document.close();
        docprint.print();
        docprint.close();
    }
    $(document).ready(function () {

        //$(".datepicker").kendoDatePicker(datePickerOptions);
        $(".datepicker").kendoDatePicker(datePickerOptions);
        $('form').removeData('validator');
        $('form').removeData('unobtrusiveValidation');
        $.validator.unobtrusive.parse('form');
        var options = {
            beforeSubmit: function (msg) {
                blockUI();
                $(".btn").prop("disabled", true);
            },
            success: function (msg) {

                $(".btn").prop("disabled", false);
                unblockUI();
                if (msg == false) {
                    return errorToast();
                }
                successToast();
                getPurchaseOrder();
            },

            error: function (jqXHR, textStatus, errorThrown) {
                handleErrors(textStatus);
                unblockUI();
                $(".btn").prop("disabled", false);

            }
        };
        $('#po-form-u').ajaxForm(options);
    });
    //$('.Purchaseorder_FKSupplierID,.quo').selectize();
</script>
